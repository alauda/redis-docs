---
weight: 10
sourceSHA: cdf96981f5cb237c9d76ab5ddf80a7c9d6ca13cd76eca1b7d3d125600bba62e1
---

# Создание экземпляра

Следующие версии Redis полностью поддерживаются: `5.0`, `6.0`, `7.2`; другие версии по умолчанию не поддерживаются.

<Directive type="tip" title="Рекомендация по версии">
  При использовании в производственной среде рекомендуется отдавать предпочтение версии `7.2`, затем `6.0`.

  1. `7.2` - это версия, которую все еще поддерживает сообщество, она исправляет известные проблемы в `6.0` и `5.0`. Версии `6.0` и `5.0` больше не поддерживаются сообществом.
  2. `7.2` полностью совместима с `6.0` и `5.0`.
  3. `7.2` значительно улучшила функции ACL.
  4. Использование `5.0` не рекомендуется, так как она не поддерживает такие продвинутые функции, как ACL, и не имеет возможностей управления пользователями; все бизнес-процессы будут использовать один общий пароль, что представляет потенциальные риски безопасности; также для изменения пароля необходимо перезапустить все узлы.
</Directive>

<Directive type="note" title="Рекомендация по архитектуре">
  `Архитектура с одним узлом` не имеет реплик и отсутствует функция переключения на резервный узел, поэтому ее следует использовать только в средах разработки и тестирования. Вы можете выбрать между `Архитектурой Sentinel` и `Кластерной архитектурой` в зависимости от потребностей вашего бизнеса в данных и параллелизме.
</Directive>

## Создание экземпляра Redis

### Процедура

<Tabs>
  <Tab label="Sentinel CLI">
    Создайте экземпляр Redis 6.0 в режиме Sentinel с помощью CLI:

    ```bash
    $ cat << EOF | kubectl -n default create -f -
    apiVersion: middleware.alauda.io/v1
    kind: Redis
    metadata:
      name: s6
    spec:
      arch: sentinel
      customConfig:
        databases: "16"
        hz: "10"
        save: 60 10000 300 100 600 1
        timeout: "0"
      exporter:
        enabled: true
        resources:
          limits:
            cpu: 100m
            memory: 384Mi
          requests:
            cpu: 50m
            memory: 128Mi
      replicas:
        sentinel:
          master: 1
          slave: 1
      resources:
        limits:
          cpu: "1"
          memory: 2Gi
        requests:
          cpu: "1"
          memory: 2Gi
      sentinel:
        monitorConfig:
          down-after-milliseconds: "30000"
          failover-timeout: "180000"
          parallel-syncs: "1"
        replicas: 3
        resources:
          limits:
            cpu: 100m
            memory: 128Mi
          requests:
            cpu: 100m
            memory: 128Mi
      version: "6.0"
    EOF
    ```

    Обратитесь к [документации API Redis](../apis/kubernetes_apis/redis/redis.mdx) для описания полей.
  </Tab>

  <Tab label="Cluster CLI">
    Создайте экземпляр Redis 6.0 в режиме Cluster с помощью CLI:

    ```bash
    $ cat << EOF | kubectl -n default create -f -
    apiVersion: middleware.alauda.io/v1
    kind: Redis
    metadata:
      name: c6
    spec:
      affinityPolicy: AntiAffinityInSharding
      arch: cluster
      customConfig:
        hz: "10"
        save: 60 10000 300 100 600 1
        timeout: "0"
      exporter:
        enabled: true
        resources:
          limits:
            cpu: 100m
            memory: 384Mi
          requests:
            cpu: 50m
            memory: 128Mi
      expose:
        type: NodePort
      replicas:
        cluster:
          shard: 3
          slave: 1
      resources:
        limits:
          cpu: 200m
          memory: 200Mi
        requests:
          cpu: 200m
          memory: 200Mi
      version: "6.0"
    EOF
    ```

    Обратитесь к [документации API Redis](../apis/kubernetes_apis/redis/redis.mdx) для описания полей.
  </Tab>

  <Tab label="Standalone CLI">
    Создайте экземпляр Redis 6.0 в режиме Standalone с помощью CLI:

    ```bash
    $ cat << EOF | kubectl -n default create -f -
    apiVersion: middleware.alauda.io/v1
    kind: Redis
    metadata:
      name: standalone
    spec:
      arch: standalone
      customConfig:
        databases: "16"
        hz: "10"
        save: 60 10000 300 100 600 1
        timeout: "0"
      exporter:
        enabled: true
        resources:
          limits:
            cpu: 100m
            memory: 384Mi
          requests:
            cpu: 50m
            memory: 128Mi
      replicas:
        sentinel:
          master: 1
      resources:
        limits:
          cpu: "1"
          memory: 1Gi
        requests:
          cpu: "1"
          memory: 1Gi
      version: "6.0"
    EOF
    ```

    Обратитесь к [документации API Redis](../apis/kubernetes_apis/redis/redis.mdx) для описания полей.
  </Tab>

  <Tab label="Веб-консоль">
    1. Перейдите в представление Услуг данных.

    2. В левом боковом меню представления Услуг данных щелкните **Redis**.

    3. Щелкните ***Имя пространства имен***.

    4. Щелкните **Создать экземпляр Redis**.

    5. Выберите тип архитектуры.

    6. Ознакомьтесь с инструкциями ниже, чтобы завершить соответствующую настройку.

           <table border="">
             <tr>
               <th style={{width: '100px'}}>Конфигурация</th>
               <th style={{width: '130px'}}>Элемент конфигурации</th>
               <th>Описание</th>
             </tr>

             <tr>
               <td><b>Конфигурация параметров</b></td>
               <td><b>Шаблон параметров</b></td>
               <td>Вы можете выбрать между системными или настраиваемыми шаблонами параметров. Для настраиваемых шаблонов параметров обратитесь к <ExternalSiteLink name="acp" href="/appservice/unified-om/para-template-mgt/index" children="Управление шаблоном параметров" />.</td>
             </tr>

             <tr>
               <td rowspan="3"><b>Конфигурация подключения</b></td>
               <td><b>Установить пароль по умолчанию</b></td>
               <td>Рекомендуется установить пароль для пользователя redis `default` при запуске экземпляра. Если пароль не установлен, обратитесь к <a href="../functions/20-user">Управление пользователями</a> для сброса пароля или создания дополнительных учетных записей.</td>
             </tr>

             <tr>
               <td><b>Метод доступа</b></td>
               <td>Если приложения и экземпляры Redis изменяются в разных кластерах нагрузки, используйте метод <b>внешнего доступа</b>. Метод <b>внешнего доступа</b> поддерживает `LoadBalancer` и `NodePort`, где `LoadBalancer` рекомендуется для производственных сред. Если приложения и экземпляры Redis изменяются в одном и том же кластере нагрузки, используйте метод доступа <b>Внутри кластера</b>.</td>
             </tr>

             <tr>
               <td><b>Указать порт хоста</b></td>
               <td>При использовании NodePort для внешнего доступа вы можете указать номера портов службы. <br /><b>Режим Sentinel</b>: При обновлении экземпляра порты не могут быть обменены; если вам нужно поменять порты, сначала обновите до другого незанятого порта, затем пересоздайте их. <br /><b>Режим кластер</b>: При обновлении экземпляра, если нужно заменить только один порт, вы можете ввести или изменить соответствующий порт узла в YAML.</td>
             </tr>

             <tr>
               <td rowspan="3"><b>Конфигурация планирования</b></td>
               <td><b>Политика антипринадлежности</b></td>
               <td>Для обеспечения высокой надежности и доступности в различных бизнес-сценариях платформа предоставляет политику антипринадлежности для <b>Кластерного режима</b>, где <b>Принудительная антипринадлежность</b> является автоматически применяемой настройкой по умолчанию. <br /><b>Примечание</b>: После создания экземпляра эту настройку нельзя изменить.</td>
             </tr>

             <tr>
               <td><b>Метки узлов</b></td>
               <td>Фильтрация доступных узлов в текущем кластере через метки. Pods будут планироваться на доступные узлы. <br /><b>Примечание</b>: После создания экземпляра эту настройку нельзя изменить.</td>
             </tr>

             <tr>
               <td><b>Допустимость Pod</b></td>
               <td> Если доступные узлы имеют отметки, только Pods с установленными допустимостями смогут терпеть эти отметки и будут планироваться на узлы, которые соответствуют допустимости Pod и отметке узла. Правила сопоставления следующие: <ul><li><b>Равно</b>: Когда <i>ключ</i>, <i>значение</i> и <i>эффект</i>, которые Pod терпит, точно совпадают с настройками отметки узла, Pod будет терпеть отметку узла. </li><li><b>Существует</b>: Когда <i>ключ</i> и <i>эффект</i>, которые Pod терпит, соответствуют настройкам отметки узла, Pod будет терпеть отметку узла. </li></ul> <br /><b>Примечание</b>: Эффект определяет, будут ли Pods, которые не терпят отметки узла, назначаться на узел с отметкой. Например, если эффект NoExecute, только Pods, которые терпят отметку (включая Pods в этом экземпляре Redis), будут планироваться, а уже работающие Pods на узле, которые не терпят отметку, будут исключены (Pods из других экземпляров). Для получения дополнительной информации о правилах сопоставления обратитесь к <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">документации сообщества Kubernetes</a>.</td>
             </tr>
           </table>

       > Текущая веб-консоль не поддерживает создание `standalone` (одиночная архитектура Redis).

    7. Щелкните **Создать**.

       Когда статус экземпляра изменится на **Работает**, экземпляр будет успешно создан.
  </Tab>
</Tabs>

После создания экземпляра вы можете использовать следующую команду для проверки статуса экземпляра:

```bash
$ kubectl -n default get redis
NAME         ARCH         VERSION   ACCESS     STATUS         MESSAGE   BUNDLE VERSION   AUTOUPGRADE   AGE
c5           cluster      5.0       NodePort   Ready                    4.0.1                         2m46s
c6           cluster      6.0                  Initializing             4.0.1                         3m26s
c7           cluster      7.2       NodePort   Initializing             4.0.1                         98s
s5           sentinel     5.0                  Ready                    4.0.1                         3m10s
s6           sentinel     6.0                  Ready                    4.0.1                         25m
s7           sentinel     7.2       NodePort   Ready                    4.0.1                         2m15s
standalone   standalone   6.0                  Initializing             4.0.1                         6s
```

Значения полей итоговой таблицы следующие:

| Поле          | Описание                                                                                                                                                                                                                                                                                                                                                                                   |
| :------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| NAME           | Имя экземпляра                                                                                                                                                                                                                                                                                                                                                                                 |
| ARCH           | Это значение соответствует архитектуре Redis. <ul><li>`cluster`: Кластерный режим</li><li> `sentinel`: Режим Sentinel </li><li>`standalone`: Одиночный Redis</li></ul> Эта строка показывает, управляет ли данный ресурс CR одиночным, Sentinel или кластерным режимом Redis.                                                                                                           |
| VERSION        | В настоящее время поддерживаются только 3 версии: `5.0`, `6.0`, `7.2`                                                                                                                                                                                                                                                                                                                                   |
| ACCESS         | Методы доступа, поддерживаемые экземпляром. <ul><li>` `: Экземпляр предоставляет услуги через ClusterIP</li><li>`NodePort`: Экземпляр предоставляет услуги через NodePort</li><li>`LoadBalancer`: Экземпляр предоставляет услуги через LoadBalancer</li></ul>                                                                                                                                     |
| STATUS         | Текущий статус экземпляра, который может включать в себя следующие состояния: <ul><li>`Initializing`: Экземпляр инициализируется или обновляется</li><li>`Rebalancing`: Экземпляр кластера масштабируется вверх или вниз</li><li>`Error`: Экземпляр столкнулся с необратимой ошибкой</li><li>`Paused`: Экземпляр был временно приостановлен</li><li>`Ready`: Экземпляр готов</li></ul> |
| MESSAGE        | Причина, по которой экземпляр находится в текущем статусе                                                                                                                                                                                                                                                                                                                                       |
| BUNDLE VERSION | Номер версии оператора, управляющего экземпляром                                                                                                                                                                                                                                                                                                                                      |
| AUTOUPGRADE    | Включены ли автоматические обновления для экземпляра                                                                                                                                                                                                                                                                                                                                       |
| AGE            | Как давно был создан экземпляр                                                                                                                                                                                                                                                                                                                                                         |
