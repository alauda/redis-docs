---
weight: 10
---

# 创建实例

您可以创建一个 Redis 实例，以获得更快的读写速度和可扩展性服务，满足业务的多样化和高可用性需求。

在当前版本，支持如下 Redis 版本: `5.0`，`6.0`, `7.2`，其他版本默认不支持。

<Directive type="tip" title="版本选择建议">
在生产环境使用时，建议优先选择 `7.2` 版本，次选 `6.0`。
1. `7.2` 是社区还在维护的版本，其修复了 `6.0`，`5.0` 已知的问题，且 `6.0`, `5.0` 社区早已不再维护。
1. `7.2` 完全兼容 `6.0` 和 `5.0`。 
1. `7.2` 进一步完善了 ACL 功能。
1. `5.0` 不建议使用，他不支持 ACL 等高级功能，无法管理用户；所有业务会公用一个密码，有潜在安全问题；且更新密码，必须重启所有节点。
</Directive>

<Directive type="warning" title="架构选择建议">
`单节点架构`没有副本节点，不具备故障切换的能力，只可以用在开发测试环境。

`哨兵架构`和`集群架构`可根据业务的数据量与并发量来选择。
</Directive>

## 创建 Redis 实例

### 操作步骤

<Tabs>

<Tab label="哨兵 CLI">

通过 CLI 创建 Redis 6.0 的哨兵模式实例:

```bash
cat << EOF | kubectl -n default create -f -
apiVersion: middleware.alauda.io/v1
kind: Redis
metadata:
  name: s6
spec:
  arch: sentinel
  customConfig:
    databases: "16"
    hz: "10"
    save: 60 10000 300 100 600 1
    timeout: "0"
  exporter:
    enabled: true
    resources:
      limits:
        cpu: 100m
        memory: 384Mi
      requests:
        cpu: 50m
        memory: 128Mi
  replicas:
    sentinel:
      master: 1
      slave: 1
  resources:
    limits:
      cpu: "1"
      memory: 2Gi
    requests:
      cpu: "1"
      memory: 2Gi
  sentinel:
    monitorConfig:
      down-after-milliseconds: "30000"
      failover-timeout: "180000"
      parallel-syncs: "1"
    replicas: 3
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 100m
        memory: 128Mi
  version: "6.0"
EOF
```

</Tab>

<Tab label="集群 CLI">

通过 CLI 创建 Redis 6.0 的集群模式实例:

```bash
cat << EOF | kubectl -n default create -f -
apiVersion: middleware.alauda.io/v1
kind: Redis
metadata:
  name: s6
spec:
  arch: sentinel
  customConfig:
    databases: "16"
    hz: "10"
    save: 60 10000 300 100 600 1
    timeout: "0"
  exporter:
    enabled: true
    resources:
      limits:
        cpu: 100m
        memory: 384Mi
      requests:
        cpu: 50m
        memory: 128Mi
  replicas:
    sentinel:
      master: 1
      slave: 1
  resources:
    limits:
      cpu: "1"
      memory: 2Gi
    requests:
      cpu: "1"
      memory: 2Gi
  sentinel:
    monitorConfig:
      down-after-milliseconds: "30000"
      failover-timeout: "180000"
      parallel-syncs: "1"
    replicas: 3
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 100m
        memory: 128Mi
  version: "6.0"
EOF
```

</Tab>

<Tab label="单节点 CLI">

通过 CLI 创建 Redis 6.0 的单节点模式实例:

```bash
cat << EOF | kubectl -n default create -f -
apiVersion: middleware.alauda.io/v1
kind: Redis
metadata:
  name: standalone
spec:
  arch: standalone
  customConfig:
    databases: "16"
    hz: "10"
    save: 60 10000 300 100 600 1
    timeout: "0"
  exporter:
    enabled: true
    resources:
      limits:
        cpu: 100m
        memory: 384Mi
      requests:
        cpu: 50m
        memory: 128Mi
  replicas:
    sentinel:
      master: 1
  resources:
    limits:
      cpu: "1"
      memory: 1Gi
    requests:
      cpu: "1"
      memory: 1Gi
  version: "6.0"
EOF
```

</Tab>

<Tab label="Web Console">

1. 在左侧导航栏中，单击 **Redis**。

2. 单击 ***命名空间的名称***。

3. 单击 **创建 Redis 实例**。

4. 选择一个架构类型。

5. 参考以下说明完成相关配置。

    <table border="">
        <tr>
            <th style={{width: '100px'}}>配置</th>
            <th style={{width: '130px'}}>配置项</th>
            <th>说明</th>
        </tr>
        <tr>
            <td><b>参数配置</b></td>
            <td><b>参数模板</b></td>
            <td>可选择系统或自定义参数模板，自定义参数模板请参考 <a href="../../unified-om/para-template-mgt/index">参数模板</a>。</td>
        </tr>
        <tr>
            <td rowspan="3"><b>连接配置</b></td>
            <td><b>设置密码</b></td>
            <td>为保证环境安全，建议您及时设置密码。<ul><li>若不设置密码，可无密码访问实例。</li><li>设置后，请妥善保管您的密码。为降低密码泄漏风险，建议定期 <a href="../functions/20-user">更新密码</a>。</li></ul></td>
        </tr>
        <tr>
            <td><b>集群外访问</b></td>
            <td><b>哨兵模式</b>：实例创建后，该配置不再允许修改。<br/><b>集群模式</b>：提供集群模式和单例模式两种集群外访问模式。集群模式性能好且稳定性高，推荐使用该模式进行集群外访问。</td>
        </tr>
        <tr>
            <td><b>指定主机端口</b></td>
            <td>集群外访问方式下开启指定主机端口后，可以指定服务端口号。<br/><b>哨兵模式</b>：更新实例时，端口不支持互换，若您需要交换端口，可以先更新为其他未被占用端口，再重新指定。<br/><b>集群模式</b>：更新实例时，若只需要替换一个端口，可以重新输入或在 YAML 中修改相应节点端口。</td>
        </tr>
        <tr>
            <td rowspan="3"><b>调度配置</b></td>
            <td><b>反亲和策略</b></td>
            <td>针对不同业务场景下的高可靠性和高可用性需求，平台为 <b>集群模式</b> 提供了反亲和策略，其中 <b>分片内主从尽量反亲和</b> 为默认应用的反亲和策略。  <br/><b>注意</b>：实例创建后，该配置不再允许修改。</td>
        </tr>
        <tr>
            <td><b>节点标签</b></td>
            <td>通过标签筛选出当前集群中的可用节点。Pod 将被调度到可用节点上。 <br/><b>注意</b>：实例创建后，该配置不再允许修改。</td>
        </tr>
        <tr>
            <td><b>Pod 容忍</b></td>
            <td> 如果可用节点设置了污点，只有设置了 Pod 容忍，Pod 才会容忍这些污点，且有可能会被调度到 Pod 容忍与节点污点相匹配的节点上。匹配规则如下。 <ul><li><b>Equal</b>：当 Pod 容忍的 <i>key</i>、<i>value</i>、<i>effect</i> 和节点污点中所设值完全一致时，Pod 会容忍节点污点。 </li><li><b>Exists</b>：当 Pod 容忍的 <i>key</i>、<i>effect</i> 和节点污点中所设值保持一致时，Pod 会容忍节点污点。 </li></ul> <br/><b>说明</b>：effect 决定了未容忍节点污点的 Pod 是否会被分配到设置了污点的节点上。例如，effect 为 NoExecute 表示只能调度容忍污点的 Pod（包括本 Redis 实例中的 Pod），且会驱逐已经在该节点上运行但不容忍污点的 Pod（其他实例的 Pod）。更多关于匹配规则的信息，参见  <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/" >Kubernetes 社区文档</a>。</td>
        </tr>
    </table>

    > 当前 Web Console 不支持创建 `standalone`(Redis 单节点架构)。

6. 单击 **创建**。

    待实例状态变为 **运行中** 时，实例创建成功。

</Tab>

</Tabs>

在实例创建之后，可通过如下命令查看实例的状态：

```bash
$ kubectl -n default get redis
NAME         ARCH         VERSION   ACCESS     STATUS         MESSAGE   BUNDLE VERSION   AUTOUPGRADE   AGE
c5           cluster      5.0       NodePort   Ready                    4.0.1                         2m46s
c6           cluster      6.0                  Initializing             4.0.1                         3m26s
c7           cluster      7.2       NodePort   Initializing             4.0.1                         98s
s5           sentinel     5.0                  Ready                    4.0.1                         3m10s
s6           sentinel     6.0                  Ready                    4.0.1                         25m
s7           sentinel     7.2       NodePort   Ready                    4.0.1                         2m15s
standalone   standalone   6.0                  Initializing             4.0.1                         6s
```

输出表格字段含义如下：

| 字段           | 说明                                      |
|:---------------|:------------------------------------------|
| NAME           | 实例名称                                  |
| ARCH           | 该值对应 Redis 的架构。<ul><li>`cluster`: 集群模式</li><li> `sentinel`: 哨兵模式 </li><li>`standalone`: 单节点 Redis</li></ul> | 该字段表明了该 CR 资源管理的是 Redis 的单例，哨兵还是集群模式 |
| VERSION        | 当前只支持`5.0`, `6.0`, `7.2`这 3 个版本  |
| ACCESS         | 实例支持的访问方式。<ul><li>` `: 实例通过 ClusterIP 对外提供服务</li><li>`NodePort`: 实例通过 NodePort 对外提供服务</li><li>`LoadBalancer`: 实例通过 LoadBalancer 对外提供服务</li></ul> |
| STATUS         | 实例当前的状态，可能有以下状态：<ul><li>`Initializing`: 实例正在初始化或者更新</li><li>`Rebalancing`: 集群实例正在扩缩容</li><li>`Error`: 实例出现不可自动回复的错误</li><li>`Paused`: 实例已经人工暂停</li><li>`Ready`: 实例已经准备就绪</li></ul> |
| MESSAGE        | 实例处于当前状态的原因                    |
| BUNDLE VERSION | 当前管理该实例的 operator 的版本号        |
| AUTOUPGRADE    | 实例是否开启自动升级                      |
| AGE            | 实例多久创建的                            |

