---
weight: 10
sourceSHA: 18880b7dab6d17d82f47c5d5078ba0354b5163c9077e7d9e7c6f8327680148b8
---

# 创建实例

以下 Redis 版本被完全支持： `5.0`，`6.0`，`7.2`；其他版本默认不被支持。

<Directive type="tip" title="版本选择建议">
在生产环境中，建议优先选择 `7.2` 版本，其次 `6.0`。
1. `7.2` 是社区仍在维护的版本，修复了 `6.0` 和 `5.0` 中的已知问题。而 `6.0` 和 `5.0` 版本已不再由社区维护。
2. `7.2` 与 `6.0` 和 `5.0` 完全兼容。
3. `7.2` 进一步改进了 ACL 功能。
4. 不推荐使用 `5.0`，因为它不支持 ACL 等高级功能，缺乏用户管理能力；所有业务流程共享一个密码，存在潜在的安全风险；而且，修改密码需要重启所有节点。
</Directive>

<Directive type="note" title="架构选择建议">
`单节点架构`没有副本节点，缺乏故障转移能力，因此只应在开发和测试环境中使用。您可以根据业务的数据和并发需求选择 `哨兵架构` 或 `集群架构`。
</Directive>

## 创建 Redis 实例

### 操作步骤

<Tabs>
  <Tab label="哨兵 CLI">
    通过 CLI 创建 Redis 6.0 哨兵模式实例：

    ```bash
    $ cat << EOF | kubectl -n default create -f -
    apiVersion: middleware.alauda.io/v1
    kind: Redis
    metadata:
      name: s6
    spec:
      arch: sentinel
      customConfig:
        databases: "16"
        hz: "10"
        save: 60 10000 300 100 600 1
        timeout: "0"
      exporter:
        enabled: true
        resources:
          limits:
            cpu: 100m
            memory: 384Mi
          requests:
            cpu: 50m
            memory: 128Mi
      replicas:
        sentinel:
          master: 1
          slave: 1
      resources:
        limits:
          cpu: "1"
          memory: 2Gi
        requests:
          cpu: "1"
          memory: 2Gi
      sentinel:
        monitorConfig:
          down-after-milliseconds: "30000"
          failover-timeout: "180000"
          parallel-syncs: "1"
        replicas: 3
        resources:
          limits:
            cpu: 100m
            memory: 128Mi
          requests:
            cpu: 100m
            memory: 128Mi
      version: "6.0"
    EOF
    ```

    字段说明，请参考 [Redis API 文档](../apis/kubernetes_apis/redis/redis.mdx)。
  </Tab>

  <Tab label="集群 CLI">
    通过 CLI 创建 Redis 6.0 集群模式实例：

    ```bash
    $ cat << EOF | kubectl -n default create -f -
    apiVersion: middleware.alauda.io/v1
    kind: Redis
    metadata:
      name: c6
    spec:
      affinityPolicy: AntiAffinityInSharding
      arch: cluster
      customConfig:
        hz: "10"
        save: 60 10000 300 100 600 1
        timeout: "0"
      exporter:
        enabled: true
        resources:
          limits:
            cpu: 100m
            memory: 384Mi
          requests:
            cpu: 50m
            memory: 128Mi
      expose:
        type: NodePort
      replicas:
        cluster:
          shard: 3
          slave: 1
      resources:
        limits:
          cpu: 200m
          memory: 200Mi
        requests:
          cpu: 200m
          memory: 200Mi
      version: "6.0"
    EOF
    ```

    字段说明，请参考 [Redis API 文档](../apis/kubernetes_apis/redis/redis.mdx)。
  </Tab>

  <Tab label="单节点 CLI">
    通过 CLI 创建 Redis 6.0 单节点模式实例：

    ```bash
    $ cat << EOF | kubectl -n default create -f -
    apiVersion: middleware.alauda.io/v1
    kind: Redis
    metadata:
      name: standalone
    spec:
      arch: standalone
      customConfig:
        databases: "16"
        hz: "10"
        save: 60 10000 300 100 600 1
        timeout: "0"
      exporter:
        enabled: true
        resources:
          limits:
            cpu: 100m
            memory: 384Mi
          requests:
            cpu: 50m
            memory: 128Mi
      replicas:
        sentinel:
          master: 1
      resources:
        limits:
          cpu: "1"
          memory: 1Gi
        requests:
          cpu: "1"
          memory: 1Gi
      version: "6.0"
    EOF
    ```

    字段说明，请参考 [Redis API 文档](../apis/kubernetes_apis/redis/redis.mdx)。
  </Tab>

  <Tab label="Web 控制台">
    1. 进入 Alauda 应用服务视图。

    2. 在 Alauda 应用服务视图的左侧导航栏中，单击 **Redis**。

    3. 单击 ***命名空间名称***。

    4. 单击 **创建 Redis 实例**。

    5. 选择架构类型。

    6. 请参考以下说明完成相关配置。

       <table border="">
         <tr>
           <th style={{width: '100px'}}>配置</th>
           <th style={{width: '130px'}}>配置项</th>
           <th>说明</th>
         </tr>

         <tr>
           <td><b>参数配置</b></td>
           <td><b>参数模板</b></td>
           <td>可选择系统或自定义参数模板，关于自定义参数模板，请参考 <ExternalSiteLink name="acp" href="/appservice/unified-om/para-template-mgt/index" children="参数模板管理" />。</td>
         </tr>

         <tr>
           <td rowspan="3"><b>连接配置</b></td>
           <td><b>设置默认密码</b></td>
           <td>为了保证环境的安全，建议在启动实例时设置 `default` 用户的密码。如果未设置密码，请参见 <a href="../functions/20-user">用户管理</a> 重置密码或创建额外账户。</td>
         </tr>

         <tr>
           <td><b>访问方式</b></td>
           <td>如果应用程序与 Redis 实例位于不同的业务集群中，请使用 <b>外部访问</b> 方法。<b>外部访问</b> 方法支持 `LoadBalancer` 和 `NodePort`，推荐在生产环境中使用 `LoadBalancer`。如果应用程序与 Redis 实例位于同一业务集群中，请使用 <b>集群内访问</b> 方法。</td>
         </tr>

         <tr>
           <td><b>指定主机端口</b></td>
           <td>使用 NodePort 进行外部访问时，可以指定服务的 NodePort 端口号。<br /><b>哨兵模式</b>：更新实例时，端口不能互换；如果需要交换端口，必须先更新为另一个未占用的端口，然后重新指定。<br /><b>集群模式</b>：更新实例时，如果只需替换一个端口，可以重新输入或修改 YAML 中相应的节点端口。</td>
         </tr>

         <tr>
           <td rowspan="3"><b>调度配置</b></td>
           <td><b>反亲和策略</b></td>
           <td>为满足不同业务场景下的高可靠性和高可用性需求，平台为 <b>集群模式</b> 提供反亲和策略，其中 <b>强制反亲和</b> 是默认的反亲和策略。<br /><b>注意</b>：实例创建后，该配置无法修改。</td>
         </tr>

         <tr>
           <td><b>节点标签</b></td>
           <td>通过标签筛选出当前集群内可用的节点。Pods 将被调度到可用节点。<br /><b>注意</b>：实例创建后，该配置都无法修改。</td>
         </tr>

         <tr>
           <td><b>Pod 容忍</b></td>
           <td>如果可用节点设置了污点，只有设置了容忍的 Pods 才能容忍这些污点，并有可能被调度到与 Pod 容忍和节点污点匹配的节点。匹配规则如下：<ul><li><b>Equal</b>：当 Pod 容忍的 <i>key</i>、<i>value</i> 和 <i>effect</i> 与节点污点设置完全一致时，Pod 会容忍节点污点。</li><li><b>Exists</b>：当 Pod 容忍的 <i>key</i> 和 <i>effect</i> 与节点污点设置保持一致时，Pod 会容忍节点污点。</li></ul><br /><b>注意</b>：effect 决定了未容忍节点污点的 Pods 是否会被分配到有污点的节点上。例如，如果 effect 为 NoExecute，则只有容忍污点的 Pods（包括本 Redis 实例中的 Pods）才会被调度，而在该节点上未容忍污点的 Pods 会被驱逐（来自其他实例的 Pods）。有关匹配规则的更多信息，请参见 <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">Kubernetes 社区文档</a>。</td>
         </tr>
       </table>

       > 当前 Web 控制台不支持创建 `standalone`（Redis 单节点架构）。

    7. 单击 **创建**。

       一旦实例状态变为 **运行中**，实例即已成功创建。
  </Tab>
</Tabs>

在实例创建后，您可以使用以下命令检查实例的状态：

```bash
$ kubectl -n default get redis
NAME         ARCH         VERSION   ACCESS     STATUS         MESSAGE   BUNDLE VERSION   AUTOUPGRADE   AGE
c5           cluster      5.0       NodePort   Ready                    4.0.1                         2m46s
c6           cluster      6.0                  Initializing             4.0.1                         3m26s
c7           cluster      7.2       NodePort   Initializing             4.0.1                         98s
s5           sentinel     5.0                  Ready                    4.0.1                         3m10s
s6           sentinel     6.0                  Ready                    4.0.1                         25m
s7           sentinel     7.2       NodePort   Ready                    4.0.1                         2m15s
standalone   standalone   6.0                  Initializing             4.0.1                         6s
```

输出表格字段的含义如下：

| 字段           | 说明                                                                                                                                                                                                                                                                                                                                                                                   |
|:---------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| NAME           | 实例名称                                                                                                                                                                                                                                                                                                                                                                                 |
| ARCH           | 该值对应 Redis 的架构。 <ul><li>`cluster`：集群模式</li><li> `sentinel`：哨兵模式</li><li>`standalone`：单节点 Redis</li></ul>  该字段指示此 CR 资源管理的是单实例、哨兵或集群模式的 Redis。                                                                                                                              |
| VERSION        | 当前仅支持以下 3 个版本：`5.0`，`6.0`，`7.2`                                                                                                                                                                                                                                                                                                                                           |
| ACCESS         | 实例支持的访问方式。 <ul><li>` `: 实例通过 ClusterIP 提供服务</li><li>`NodePort`：实例通过 NodePort 提供服务</li><li>`LoadBalancer`：实例通过 LoadBalancer 提供服务</li></ul>                                                                                                                                                                                                   |
| STATUS         | 实例当前状态，可能包括以下状态： <ul><li>`Initializing`：实例正在初始化或更新</li><li>`Rebalancing`：集群实例正在扩缩容</li><li>`Error`：实例遇到不可恢复的错误</li><li>`Paused`：实例已被手动暂停</li><li>`Ready`：实例已准备就绪</li></ul>                                                             |
| MESSAGE        | 实例处于当前状态的原因                                                                                                                                                                                                                                                                                                                                                                   |
| BUNDLE VERSION | 管理此实例的操作器版本号                                                                                                                                                                                                                                                                                                                                                                  |
| AUTOUPGRADE    | 实例是否启用自动升级                                                                                                                                                                                                                                                                                                                                                                     |
| AGE            | 实例创建时间                                                                                                                                                                                                                                                                                                                                                                               |
