---
weight: 75
---

# 监控告警

内嵌面板中的监控数据可用于从资源、性能等方面进行 Redis 监控与告警，且支持配置通知策略。

直观呈现的监控数据可用于为运维巡检或性能调优提供决策支持，完善的告警和通知机制也将帮助保障数据库稳定运行。

## 监控

平台默认收集 Redis 的资源、性能等常用监控指标。在实例的 **监控** 页签中，可查看指标的实时监控数据。


| 类别     | 指标                                                         |
| -------- | ------------------------------------------------------------ |
| **集群状态监控** | 键数目统计、命令统计等 |
| **资源监控** | 内存使用量、网络流量等                           |
| **性能监控** | 连接数、网络 I/O 等 |

## 告警

进入 Application Service 的 **告警** > **告警策略** 页面，可为 Redis 创建告警对应的告警策略(也可以使用平台通用的告警功能去创建告警）。

### 配置告警策略

为启用告警，请先在 Application Service 中创建告警策略。告警策略描述了您希望监控的对象、在什么情况下希望收到告警，以及如何被通知相关告警。

平台内置了如下告警指标：

| 名称                | 推荐触发条件       | 说明           |
|:--------------------|:-------------------|:---------------|
| 实例状态            | \!\=1，且持续30秒   | 监控集群的可用性 |
| Key 访问命中率      | \<80%，且持续30秒   | 监控 Key 的命中率，如果命中率过低说明访问的 Key 都不存在，需要调整缓存策略，增加缓存TTL等。|
| 平均响应时间        | \>0.1s，且持续30秒 | 响应时间过长，会导致业务处理能力下降；需要排查是不是 CPU 存在瓶颈，或者请求量过大，或者存在 BigKey 的情况。|
| 主从发生切换        | \=1，且持续30秒     | 如果发生了主从切换，可能是K8s 集群节点故障，或者Redis 节点出现问题。                       |
| 单节点输入带宽      | 根据硬件条件判断   | 实时监控带宽情况，防止带宽资源占用引起其他业务异常。|
| 单节点输出带宽      | 根据硬件条件判断   | 实时监控带宽情况，防止带宽资源占用引起其他业务异常。|
| 单节点客户端连接数  | 根据资源条件判断   | 用于监控异常链接情况。 |
| 节点 CPU 使用率     | \>80%，且持续30秒   | 实时监控 CPU 情况，如果 CPU 占用过大，需要考虑扩容。|
| 节点内存使用率      | \>80%，且持续30秒   | 实时监控内存情况，如果内存占用过大，需要立即扩容。  |
| 节点存储空间使用率  | \>80%，且持续30秒   | 实时监控存储空间情况，如果占用过大，需要考虑扩容。  |

通过以上告警指标可快速创建告警策略。除了内置告警指标，还可以自定义告警指标，格式如下：

```yaml
(1/(1+(avg(irate(redis_keyspace_misses_total{namespace=~"<namespace>", pod=~"<podname prefix>-.*"}[5m])) by(namespace,service) / (avg(irate(redis_keyspace_hits_total{namespace=~"<namespace>", pod=~"<podname prefix>-.*"}[5m])) by(namespace,service)+1))))
```
这里 `redis_keyspace_misses_total` 是 Prometheus 收集到的指标名称，`<namespace>` 用于过滤资源所在的命令空间，`<podname prefix>`是Pod 的前缀，用于匹配 `Deployment`或者 `Statefulset`创建的 Pod。跟多更详细的指标的编写方法，可参考 [PromQL 官方文档](https://prometheus.io/docs/prometheus/latest/querying/basics/)。

更多关于告警的配置和使用，请参考<ExternalSiteLink name="acp" href="appservice/unified-om/alert-policy-mgt/index" children="告警策略管理" />。
